<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Artorithmia</title>

    <!-- Bootstrap Core CSS -->
    <link href="static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="static/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">

    <!-- Theme CSS -->
    <link href="static/css/grayscale.min.css" rel="stylesheet">
    <link href="static/css/custom.css" rel="stylesheet">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>

    .links line {
      stroke: #999;
      stroke-opacity: 0.6;
    }

    .nodes circle {
      stroke: #fff;
      stroke-width: 1.5px;
    }

    </style>

</head>

<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">

    <!-- Navigation -->
    <nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                    Menu <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand page-scroll" href="#page-top">
                    <i class="fa fa-play-circle"></i> <span class="light">Start</span> Exploring
                </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
                <ul class="nav navbar-nav">
                    <!-- Hidden li included to remove active class from about link when scrolled up past about section -->
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#about">About</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#science">The Science</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#recommend">Clusters</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Intro Header -->
    <header class="intro">
        <div class="intro-body">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 col-md-offset-2">
                        <h1 class="brand-heading light"><strong>Art</strong>orithmia</h1>
                        <h2>Art Recommendation Engine</h2>
                        <a href="#about" class="btn btn-circle page-scroll">
                            <i class="fa fa-angle-double-down animated"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Science Section -->
    <section id="about" class="container content-section text-center">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <h2>About Artorithmia</h2>
                <p>There's a lot of amazing art out there, far too much to
                  explore on your own. Using the power of machine learning
                  and artist know-how Artorithmia makes the process of
                  finding pieces you like smarter and more fun.</p>
            </div>
            <div class="row">
                    <img src="static/img/pipeline.png" align="center" width='800px'></img>
            </div>
        </div>
    </section>

    <!-- Science Section -->
    <section id="science" class="container content-section text-center">
        <div class="row">
                <h2>Feature Extraction</h2>
                <img src="static/img/art_features.png" align="center"></img>
        </div>
    </section>

    <!-- Recommend Section -->
    <section id="recommend" class="container content-section text-center">
        <div class="row">
              <div class="col-sm-6">
                  <h2>Explore and Discover</h2>
                  <h5>each node represents a piece of art</h5>
                  <div id="d3_ex"></div>
              </div>
              <div class="col-sm-6">
                    <div id="likes">
                        <ul class="list-inline banner-social-buttons">
                          <li>
                              <button class='btn btn-default btn-lg' id='like_button' data-art={{items[0].hero_id}}>like</button>
                            </li>
                      </ul>
                    </div>
                    <div id="art">
                    <img style="margin: 20px 50px" id='recommender_image' src="{{items[0].hero}}"></img>
                    <h3><span id="art-title">{{items[0].hero_title}}</span></h3>
                    <table align='center'>
                        <tr>
                          <td class='tb-left'><h4>Size:</h4></th>
                          <td><h4><span id="art-width-tag">{{items[0].hero_width}}</span>' x <span id="art-height-tag">{{items[0].hero_height}}</span>'</h4></th>
                        </tr>
                        <tr>
                          <td class='tb-left'><h4>Medium:</h4></td>
                          <td><h4><span id="art-medium-tag">{{items[0].hero_medium}}</span></h4></td>
                        </tr>
                        <tr>
                          <td class='tb-left'><h4>Retail Price:</h4></td>
                          <td><h4>$<span id="retail-price-tag">{{items[0].hero_retail_price}}</span></h4></td>
                        </tr>
                      </table>
                        <a href='http://drizl.co'><button class='btn btn-default btn-lg' id='like_button' data-art={{items[0].hero_id}}>Buy Me</button></a>
                    </div>
            </div>
        </div>
    <!--Liked Artworks\ Section -->
    </section>
    <section id="likes" class="container">
    <div class="row">
      <div class="col-sm-6">
        <h2>Liked Artwork</h2>
      </div>
    </div>
    <div class="row-fluid">
      <div class="col-lg-12 col-md-10 ">
        <div class="cover-container">
          <ul class='likedimages' id="my-list">
          </ul>
        </div>
      </div>
    </div>
  </section>

    <!-- Contact Section -->
    <section id="contact" class="container content-section text-center">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <h2>Let's Chat!</h2>
                <p>Comments and questions are more than welcome</p>
                <p><a href="mailto:aaron@aaronlichtner.com">aaron@aaronlichtner.com</a>
                </p>
                <ul class="list-inline banner-social-buttons">
                    <li>
                        <a href="https://twitter.com/SBootstrap" class="btn btn-default btn-lg"><i class="fa fa-twitter fa-fw"></i> <span class="network-name">Twitter</span></a>
                    </li>
                    <li>
                        <a href="https://github.com/alichtner" class="btn btn-default btn-lg"><i class="fa fa-github fa-fw"></i> <span class="network-name">Github</span></a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/in/aaron.lichtner" class="btn btn-default btn-lg"><i class="fa fa-google-plus fa-fw"></i> <span class="network-name">LinkedIn</span></a>
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container text-center">
            <p>Copyright &copy; Aaron Lichtner 2016</p>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="static/vendor/jquery/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="static/vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

    <!-- Theme JavaScript -->
    <script src="static/js/grayscale.min.js"></script>

    <!-- d3 JavaScript -->
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>
var likedItems = {};
var width = document.getElementById("d3_ex").clientWidth,
    height = 600
    padding = 3, // separation between same-color circles
    clusterPadding = 6, // separation between different-color circles
    maxRadius = 5;

var n = {{items[0].collection_size}}, // total number of circles
    m = {{items[0].n_clusters}}, // number of distinct clusters
    data = {{items[0].data|safe}},
    heroNode = {{items[0].hero_id}};

var color = d3.scale.category10()
    .domain(d3.range(m));

// The largest node for each cluster.
var clusters = new Array(m);

var nodes = data.map(function(d) {
  var i = d.cluster,
      r = d.radius * maxRadius + 1,
      t = d.art_title,
      id = d.id_,
      u = d.url,
      p = d.retail_price,
      m = d.medium,
      w = d.art_width,
      h = d.art_height,
      d = {"cluster": i, "radius": r, "id_":id, "url": u, "art_title": t,
           "retail_price": p, "medium": m, "art_width": w, "art_height": h};
  if (!clusters[i] || (r > clusters[i].radius)) clusters[i] = d;
  return d;
});

// Use the pack layout to initialize node positions.
d3.layout.pack()
    .sort(null)
    .size([width, height])
    .children(function(d) { return d.values; })
    .value(function(d) { return d.radius * d.radius; })
    .nodes({values: d3.nest()
      .key(function(d) { return d.cluster; })
      .entries(nodes)});

var svg = d3.select("#d3_ex").append("svg")
    .attr("width", width)
    .attr("height", height);

    var force = d3.layout.force()
        .nodes(nodes)
        .size([width, height])
        .gravity(0.02)
        .charge(0)
        .on("tick", tick)
        .start();

    var circles = svg.selectAll("circle")
        .data(nodes)
      .enter().append("circle")
    //    .attr("r", function(d) { return d.radius; })
        .attr("id_", function(d) {return d.id_; })
        .attr("url", function(d) {return d.url; })
        .attr("art_title", function(d) {return d.art_title; })
        .attr("retail_price", function(d) {return d.retail_price; })
        .attr("medium", function(d) {return d.medium; })
        .attr("art_width", function(d) {return d.art_width; })
        .attr("art_height", function(d) {return d.art_height; })
        .style("fill", function(d) { return color(d.cluster); })
        .on("mouseup", pullart)
        .on("mousedown", function(d) {d3.select(this).transition().duration(1000).style("fill", "white").transition().delay(1000).style("fill", color(d.cluster))})
         ;

    circles.transition()
        .duration(3000)
        .delay(function(d, i) { return i * 5; })
        .attrTween("r", function(d) {
          var i = d3.interpolate(0, d.radius);
          return function(t) { return d.radius = i(t); };
        });

function pullart() {
    // grab and send the artwork image and metadata about the selected node
    document.getElementById("recommender_image").src=d3.select(this).attr("url");
    document.getElementById("like_button").setAttribute('data-art', d3.select(this).attr("id_"));
    document.getElementById("art-title").innerHTML=d3.select(this).attr("art_title");
    document.getElementById("retail-price-tag").innerHTML=d3.select(this).attr("retail_price");
    document.getElementById("art-medium-tag").innerHTML=d3.select(this).attr("medium");
    document.getElementById("art-width-tag").innerHTML=d3.select(this).attr("art_width");
    document.getElementById("art-height-tag").innerHTML=d3.select(this).attr("art_height");
}

function updateList() {
  var myList = $('#my-list');
  myList.empty();

  for(var id in likedItems) {
    myList.append($(`<li class='likedimages'><img src="${likedItems[id].imageUrl}" width='200px' hspace='20px'></li>`));
  }
}


function updateData(json) {
      var data = json['0']['data']

      var nodes = data.map(function(d) {
        var i = d.cluster,
            r = d.radius * maxRadius + 1,
            t = d.art_title,
            id = d.id_,
            u = d.url,
            p = d.retail_price,
            m = d.medium,
            w = d.art_width,
            h = d.art_height,
            d = {"cluster": i, "radius": r, "id_":id, "url": u, "art_title": t, "retail_price": p, "medium": m, "art_width": w, "art_height": h};
        if (!clusters[i] || (r > clusters[i].radius)) clusters[i] = d;
        return d;
      });

      var force = d3.layout.force()
          .nodes(nodes)
          .size([width, height])
          .gravity(0.02)
          .charge(0)
          .on("tick", tick)
          .start();

      circles.transition()
          .duration(750)
          .delay(function(d, i) { return i * 5; })
          .attrTween("r", function(d, i) {
            var i = d3.interpolate(d.radius, data[i].radius * maxRadius);
            return function(t) { return d.radius = i(t); };
          });
}

$("#like_button").click(function() {
  var art_id = this.getAttribute("data-art")
  likedItems[art_id] = {
    imageUrl: document.getElementById("recommender_image").src
  };

  updateList();

  $.ajax({
      type: "GET",
      url: "/likes/" + art_id,
      success: function(results) {
          updateData(results.items)
          console.log('success')
      }
  })
})

function highlight() {
    d3.select(this).transition()
        .duration(1000)
        .attr("r", 3)
        .style("fill", "white")
      .transition()
        .delay(500)
        .style("fill", "blue");
};

function tick(e) {
  circles
      .each(cluster(10 * e.alpha * e.alpha))
      .each(collide(.5))
      .attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; });
}

// Move d to be adjacent to the cluster node.
function cluster(alpha) {
  return function(d) {
    var cluster = clusters[d.cluster];
    if (cluster === d) return;
    var x = d.x - cluster.x,
        y = d.y - cluster.y,
        l = Math.sqrt(x * x + y * y),
        r = d.radius + cluster.radius;
    if (l != r) {
      l = (l - r) / l * alpha;
      d.x -= x *= l;
      d.y -= y *= l;
      cluster.x += x;
      cluster.y += y;
    }
  };
}


// Resolves collisions between d and all other circles.
function collide(alpha) {
  var quadtree = d3.geom.quadtree(nodes);
  return function(d) {
    var r = d.radius + maxRadius + Math.max(padding, clusterPadding),
        nx1 = d.x - r,
        nx2 = d.x + r,
        ny1 = d.y - r,
        ny2 = d.y + r;
    quadtree.visit(function(quad, x1, y1, x2, y2) {
      if (quad.point && (quad.point !== d)) {
        var x = d.x - quad.point.x,
            y = d.y - quad.point.y,
            l = Math.sqrt(x * x + y * y),
            r = d.radius + quad.point.radius + (d.cluster === quad.point.cluster ? padding : clusterPadding);
        if (l < r) {
          l = (l - r) / l * alpha;
          d.x -= x *= l;
          d.y -= y *= l;
          quad.point.x += x;
          quad.point.y += y;
        }
      }
      return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
    });
  };
}
</script>


</body>

</html>
